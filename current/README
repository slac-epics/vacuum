2013-05-09

A. Wallace

This is a module for the vacuum IOCs. Basically I want to have one place to
keep all the templates for the vacuum IOCs used in LCLS. Additionally, this will
help keep everyone's IOC version up-to-date.

To use it on your vacuum IOC make sure you release file looks like this:
###############################################3
# RELEASE
# Defines location of external products
include $(TOP)/RELEASE_SITE

# ===============================================================
# Define the version of our generic vacuum ioc and
# use it's release settings
# ===============================================================
VAC_IOC_VERSION=<version of module you want to use>
include $(EPICS_SITE_TOP)/modules/vacuum/$(VAC_IOC_VERSION)/configure/RELEASE

VACUUM=$(EPICS_SITE_TOP)/modules/vacuum/$(VAC_IOC_VERSION)/
##########################################################

Also, add this line to your ***App/src/Makefile:
iocname_LIBS += vacuum

**** Sometimes the build will fail unless you include this line in your src makefile: PROD_SYS_LIBS_DEFAULT += pcre ****

**** Using the sync templates ****

1. Edit the Db/Makefile to install the sync_master.db: DB += sync_master.db
2. Edit all gauge controller sub files to use the sync templates, also you must now include the subfile events and phase, see example:
#################################

#==============================================================================
#
# Name: mks937a_R35-22a.substitutions 
#
# Macros:
#        IOC     : IOC Name
#==============================================================================
#
file sync_mks937a_serial.template
{
    pattern { controller       ,  port             , slowEvt, phase }
    	    { XPP:R35:GCT:22:A ,  XPP:R35:GCT:22:A,       3,     9 }
}

file sync_mks937a_serial_cc.template
{
    pattern { device        , port            , channel , slot, fastEvt, slowEvt }
	    { XPP:SB3:GCC:01, XPP:R35:GCT:22:A, 1, CC ,       1,       3 }
	    { XPP:SB3:GCC:02, XPP:R35:GCT:22:A, 2, A1,       1,       3 }
}

file sync_mks937a_serial_pr.template
{
    pattern { device        , port            , channel , slot, fastEvt, slowEvt }
	    { XPP:SB3:GPI:01, XPP:R35:GCT:22:A, 4, B1,       1,       3 }
	    { XPP:SB3:GPI:02, XPP:R35:GCT:22:A, 5, B2,       1,       3 }
}

##############################
3. Rebuild Db
4. Add this line to your st.cmd (replace IOC:XPP:VACUUM with the IOC name): dbLoadRecords("$(VACUUM)/db/sync_master.db", "IOC=IOC:XPP:VACUUM,scanRate='1 second',fastEvt=1,medEvt=2,slowEvt=3")
5. Reload the IOC, all the MKS controllers should be perfectly happy now and never go bad!

Add info here for using the sync templates

That should do it!

Now you don't have to keep the .template files for the vacuum devices in your IOC files. They will be sourced from this module,
which will make the vacuum IOC easier to maintain.